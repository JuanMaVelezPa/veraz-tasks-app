<div class="max-w-7xl mx-auto p-4">
  <shared-feedback-message />

  @if (isLoadingUser()) {
  <shared-loading />
  } @else if (currentUser()) {
  <!-- Header -->
  <div class="mb-6">
    <h1 class="text-2xl font-bold">My Profile</h1>
    <p class="text-sm text-base-content/70">Manage your account and personal information</p>
  </div>

  <!-- Navigation Tabs -->
  <shared-tabs
    [tabs]="tabs()"
    [activeTab]="activeTab()"
    (activeTabChange)="setActiveTab($event)"
  />

  <!-- Main Content -->
  @if (activeTab() === 'user') {
  <app-user-tab
    [currentUser]="currentUser()"
    [isEditMode]="true"
    [isLoadingUser]="isLoadingUser()"
    [userForm]="userForm"
    [isReadOnly]="true"
    (formSubmitted)="onUserFormSubmitted()"
    (roleSelected)="onRoleSelected($event)"
  />
  }

  @if (activeTab() === 'person') {
  <app-personal-info-tab
    [personForm]="personForm"
    [person]="personalProfile() || null"
    [isEditMode]="!!personalProfile()"
    [isLoading]="isLoadingPerson()"
    [isReadOnly]="true"
    (formSubmitted)="onPersonFormSubmitted()"
    (personUpdated)="onPersonUpdated($event)"
    (personCreated)="onPersonCreated($event)"
  />
  }

  @if (activeTab() === 'employment') {
  <app-employee-tab
    [employeeForm]="employmentForm"
    [employee]="employmentProfile() || null"
    [isEditMode]="!!employmentProfile()"
    [isLoading]="isLoadingEmployment()"
    [isLoadingEmployee]="isLoadingEmployment()"
    [isReadOnly]="true"
    (formSubmitted)="onEmploymentFormSubmitted()"
  />
  }

  @if (activeTab() === 'client') {
  <app-client-tab
    [clientForm]="clientForm"
    [client]="clientProfile() || null"
    [isEditMode]="!!clientProfile()"
    [isLoading]="isLoadingClient()"
    [isLoadingClient]="isLoadingClient()"
    [isReadOnly]="true"
    (formSubmitted)="onClientFormSubmitted()"
  />
  }
  } @else {
  <div class="alert alert-error shadow-lg">
    <shared-icon type="error" />
    <div>
      <h3 class="font-bold text-sm">Error!</h3>
      <div class="text-xs">Failed to load your profile. Please try again.</div>
    </div>
  </div>
  }
</div>
