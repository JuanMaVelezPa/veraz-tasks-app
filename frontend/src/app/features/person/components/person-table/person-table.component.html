<div class="bg-base-100 rounded-lg shadow-lg p-3 w-full">
  <div class="flex flex-col sm:flex-row gap-3 items-start sm:items-center justify-between mb-3">
    <app-search-bar
      placeholder="Search persons..."
      (searchChange)="handleSearch($event)"
    />

    <!-- Name Order Toggle -->
    <div class="form-control">
      <label class="label cursor-pointer gap-2">
        <span class="label-text text-sm">Last Name First</span>
        <input
          type="checkbox"
          class="toggle toggle-primary toggle-sm"
          [checked]="showLastNameFirst()"
          (change)="toggleNameOrder()"
        />
      </label>
    </div>
  </div>

  <div class="mt-3 w-full">
    <div class="overflow-x-auto">
      <table class="table table-zebra w-full">
        <thead>
          <tr>
            @for (column of columns; track column.key) {
            <th
              [class.cursor-pointer]="column.sortable"
              [class.hover:bg-base-200]="column.sortable"
              (click)="handleSort(column.key)"
              class="transition-colors duration-200"
            >
              <div class="flex items-center gap-2">
                <span [class]="getSortClass(column.key)">
                  {{ column.label }}{{ getSortLabel(column.key) }}
                </span>
                @if (column.sortable) {
                <i
                  class="fa-solid"
                  [class]="getSortIcon(column.key)"
                ></i>
                }
              </div>
            </th>
            }
          </tr>
        </thead>
        <tbody>
          @for (person of personsResource.value()?.data ?? []; track person.id; let i = $index) {
          <tr class="hover:bg-base-100">
            <td>
              <div class="flex items-center gap-3">
                <div>
                  <a
                    [routerLink]="['/admin/persons', person.id]"
                    class="font-bold hover:text-accent transition-colors duration-300"
                  >
                    {{ getFullName(person) }}
                  </a>
                </div>
              </div>
            </td>
            <td>{{ getIdentificationTypeName(person.identType) }} - {{ person.identNumber }}</td>
            <td>{{ person.email }}</td>
            <td>{{ person.mobile }}</td>
            <td>{{ person.city }}</td>
            <td>{{ person.createdAt | date:'dd/MM/yyyy' }}</td>
            <td>
              <span
                class="badge badge-sm mr-1"
                [class]="person.isActive ? 'badge-success' : 'badge-error'"
              >
                {{ person.isActive ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>
              <a
                [routerLink]="['/admin/persons', person.id]"
                class="btn btn-info btn-sm"
              >
                Details
              </a>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  @if(personsResource.isLoading()) {
  <div class="flex justify-center items-center h-32">
    <app-loading></app-loading>
  </div>
  }

  @if(personsResource.error()) {
  <div class="alert alert-error mt-4">
    <i class="fa-solid fa-exclamation-triangle"></i>
    <span>Error: {{ personsResource.error()?.message }}</span>
  </div>
  }

  <app-pagination
    [totalPages]="personsResource.value()?.pagination?.totalPages ?? 0"
    [totalItems]="personsResource.value()?.pagination?.totalElements ?? 0"
    [itemsPerPage]="personsPerPage()"
  />
</div>
